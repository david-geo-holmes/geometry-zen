<script src="../dist/davinci.min.js" type="text/javascript"></script>
<script type="text/javascript">
  // JavaScript in-vogue indenting is 2 spaces with K and R braces.
  function outputHandler(text) {
    var output = document.getElementById("output");
    text = text.replace(/</g, '&lt;');
    output.innerHTML = output.innerHTML + text;
  }

  function runit() {
    var prog = document.getElementById("code").value;
    var output = document.getElementById("output");
    output.innerHTML = '';
    Sk.configure({output:outputHandler});
    try {
      var module = Sk.importMainWithBody("<stdin>", false, prog);
      // Execution is complete. We no go after the global variable called 'a'.
      var obj = module.tp$getattr('a');
      // 'a' is an instance of the Test class and we bind to the 'run' method.
      var runMethod = obj.tp$getattr('run');
      // We call the 'run' method with 10 as argument.
      // As expected, we don't have to provide self which is the thing referenced by 'a'.
      var ret = Sk.misceval.callsim(runMethod, 15);
      // The values are typically in the 'v' property, which I think is an evolving
      // standard to facilitate type adornement.
      // In this case: {"v": 20, "skType": "int"}.
      alert("a.run(15) => " + JSON.stringify(ret, null, 2));
    }
    catch (e) {
      alert(e);
    }
  }
</script>
<form>
<textarea id="code" rows="24" cols="80">
# Here we declare a class and invoke a method on an instance after in JavaScript.
# Note: Python indenting is traditionally 4 spaces.
class Test:
    def run(self, b):
        self.x = 10 + b
        return self.x
# Expect the traditional greeting to appear in the output below.
print "Hello World"
# After the Python script has executed we will grab the global 'a'
# and invoke it's 'run' method.
a = Test()
</textarea><br>
<button onclick="runit()" type="button">Run</button>
</form>

<pre id="output"></pre>
